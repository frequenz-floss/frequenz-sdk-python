
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Frequenz Python SDK.">
      
      
        <meta name="author" content="Frequenz Energy-as-a-Service GmbH">
      
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="power_distributing/">
      
      <link rel="icon" href="../../../../../logo.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.15">
    
    
      
        <title>power_distributing - Frequenz Python SDK</title>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../../css/style.css">
    
      <link rel="stylesheet" href="../../../../../css/mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-purple">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#frequenz.sdk.actor.power_distributing" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
          <aside class="md-banner md-banner--warning">
            <div class="md-banner__inner md-grid md-typeset">
              
  You're not viewing the latest (stable) version.
  <a href="../../../../../.."> 
    <strong>Click here to go to latest (stable) version</strong>
  </a>

            </div>
            <script>var el=document.querySelector("[data-md-component=outdated]"),outdated=__md_get("__outdated",sessionStorage);!0===outdated&&el&&(el.hidden=!1)</script>
          </aside>
        
      </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../../.." title="Frequenz Python SDK" class="md-header__button md-logo" aria-label="Frequenz Python SDK" data-md-component="logo">
      
  <img src="../../../../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Frequenz Python SDK
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              power_distributing
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="deep-purple"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
            
              <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
              </label>
            
          
            
            
            
            <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="teal"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
            
              <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
              </label>
            
          
        </form>
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/frequenz-floss/frequenz-sdk-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    frequenz-sdk-python
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../.." class="md-tabs__link">
      Home
    </a>
  </li>

      
        
  
  
    
  


  
  
  
    <li class="md-tabs__item">
      <a href="../../../../conftest/" class="md-tabs__link md-tabs__link--active">
        API Reference
      </a>
    </li>
  

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../../../../CONTRIBUTING/" class="md-tabs__link">
      Development
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../../.." title="Frequenz Python SDK" class="md-nav__button md-logo" aria-label="Frequenz Python SDK" data-md-component="logo">
      
  <img src="../../../../../logo.png" alt="logo">

    </a>
    Frequenz Python SDK
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/frequenz-floss/frequenz-sdk-python" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    frequenz-sdk-python
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          API Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../conftest/" class="md-nav__link">
        conftest
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          frequenz
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          frequenz
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1" checked>
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../">sdk</a>
          
            <label for="__nav_2_2_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1">
          <span class="md-nav__icon md-icon"></span>
          sdk
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_1" checked>
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../">actor</a>
          
            <label for="__nav_2_2_1_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_1_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1_1">
          <span class="md-nav__icon md-icon"></span>
          actor
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_1_1" checked>
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index md-nav__link--active">
          <a href="./">power_distributing</a>
          
            <label for="__nav_2_2_1_1_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_2_1_1_1_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_2_2_1_1_1">
          <span class="md-nav__icon md-icon"></span>
          power_distributing
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="power_distributing/" class="md-nav__link">
        power_distributing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="request/" class="md-nav__link">
        request
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="result/" class="md-nav__link">
        result
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../config/" class="md-nav__link">
        config
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_3" >
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../microgrid/">microgrid</a>
          
            <label for="__nav_2_2_1_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_1_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_1_3">
          <span class="md-nav__icon md-icon"></span>
          microgrid
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../microgrid/client/" class="md-nav__link">
        client
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../microgrid/component/" class="md-nav__link">
        component
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../microgrid/connection_manager/" class="md-nav__link">
        connection_manager
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../power/" class="md-nav__link">
        power
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_5" >
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../timeseries/">timeseries</a>
          
            <label for="__nav_2_2_1_5">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_2_1_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_1_5">
          <span class="md-nav__icon md-icon"></span>
          timeseries
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_1_5_1" >
      
      
      
        
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../../timeseries/battery_pool/">battery_pool</a>
          
            <label for="__nav_2_2_1_5_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" data-md-level="5" aria-labelledby="__nav_2_2_1_5_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_1_5_1">
          <span class="md-nav__icon md-icon"></span>
          battery_pool
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../timeseries/battery_pool/battery_pool/" class="md-nav__link">
        battery_pool
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../timeseries/ev_charger_pool/" class="md-nav__link">
        ev_charger_pool
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../timeseries/logical_meter/" class="md-nav__link">
        logical_meter
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../../../CONTRIBUTING/" class="md-nav__link">
        Development
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing" class="md-nav__link">
    power_distributing
  </a>
  
    <nav class="md-nav" aria-label="power_distributing">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.BatteryStatus" class="md-nav__link">
    BatteryStatus
  </a>
  
    <nav class="md-nav" aria-label="BatteryStatus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.BatteryStatus-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.uncertain" class="md-nav__link">
    uncertain
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.working" class="md-nav__link">
    working
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.BatteryStatus-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.get_working_batteries" class="md-nav__link">
    get_working_batteries()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.Error" class="md-nav__link">
    Error
  </a>
  
    <nav class="md-nav" aria-label="Error">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.Error-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.result.Error.msg" class="md-nav__link">
    msg
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.OutOfBound" class="md-nav__link">
    OutOfBound
  </a>
  
    <nav class="md-nav" aria-label="OutOfBound">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.OutOfBound-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.result.OutOfBound.bound" class="md-nav__link">
    bound
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.PartialFailure" class="md-nav__link">
    PartialFailure
  </a>
  
    <nav class="md-nav" aria-label="PartialFailure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.PartialFailure-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.result.PartialFailure.failed_batteries" class="md-nav__link">
    failed_batteries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.result.PartialFailure.failed_power" class="md-nav__link">
    failed_power
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.PowerDistributingActor" class="md-nav__link">
    PowerDistributingActor
  </a>
  
    <nav class="md-nav" aria-label="PowerDistributingActor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.PowerDistributingActor-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.power_distributing.PowerDistributingActor.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.power_distributing.PowerDistributingActor.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.Request" class="md-nav__link">
    Request
  </a>
  
    <nav class="md-nav" aria-label="Request">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.Request-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.request.Request.adjust_power" class="md-nav__link">
    adjust_power
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.request.Request.batteries" class="md-nav__link">
    batteries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.request.Request.include_broken_batteries" class="md-nav__link">
    include_broken_batteries
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.request.Request.namespace" class="md-nav__link">
    namespace
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.request.Request.power" class="md-nav__link">
    power
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.request.Request.request_timeout_sec" class="md-nav__link">
    request_timeout_sec
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.Result" class="md-nav__link">
    Result
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#frequenz.sdk.actor.power_distributing.Success" class="md-nav__link">
    Success
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>power_distributing</h1>

<div class="doc doc-object doc-module">



<h2 id="frequenz.sdk.actor.power_distributing" class="doc doc-heading">
          <code>frequenz.sdk.actor.power_distributing</code>


<a href="#frequenz.sdk.actor.power_distributing" class="headerlink" title="Permanent link">¤</a></h2>

  <div class="doc doc-contents first">
  
      <p>This module provides feature to set power between many batteries.</p>
<p>Distributing power is very important to keep the microgrid ready
for the power requirements.
This module provides PowerDistributingActor that knows how to distribute power.
It also provides all the secondary features that should be used to communicate with
PowerDistributingActor and send requests for charging or discharging power.</p>

  

  <div class="doc doc-children">






<h3 id="frequenz.sdk.actor.power_distributing-classes">Classes<a href="#frequenz.sdk.actor.power_distributing-classes" class="headerlink" title="Permanent link">¤</a></h3>

<div class="doc doc-object doc-class">



<h4 id="frequenz.sdk.actor.power_distributing.BatteryStatus" class="doc doc-heading">
        <code>frequenz.sdk.actor.power_distributing.BatteryStatus</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.BatteryStatus" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">

  
      <p>Status of the batteries.</p>


        <details class="quote">
          <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/_battery_pool_status.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">BatteryStatus</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Status of the batteries.&quot;&quot;&quot;</span>

    <span class="n">working</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set of working battery ids.&quot;&quot;&quot;</span>

    <span class="n">uncertain</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set of batteries that should be used only if there are no working batteries.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_working_batteries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batteries</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;From the given set of batteries return working batteries.</span>

<span class="sd">        Args:</span>
<span class="sd">            batteries: Set of batteries</span>

<span class="sd">        Returns:</span>
<span class="sd">            Subset with working batteries.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">working</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">working</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">batteries</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">working</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">working</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertain</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">batteries</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h5 id="frequenz.sdk.actor.power_distributing.BatteryStatus-attributes">Attributes<a href="#frequenz.sdk.actor.power_distributing.BatteryStatus-attributes" class="headerlink" title="Permanent link">¤</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.uncertain" class="doc doc-heading">
<code class="highlight language-python"><span class="n">uncertain</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.uncertain" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>Set of batteries that should be used only if there are no working batteries.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.working" class="doc doc-heading">
<code class="highlight language-python"><span class="n">working</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.working" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>Set of working battery ids.</p>
  </div>

</div>

<h5 id="frequenz.sdk.actor.power_distributing.BatteryStatus-functions">Functions<a href="#frequenz.sdk.actor.power_distributing.BatteryStatus-functions" class="headerlink" title="Permanent link">¤</a></h5>

<div class="doc doc-object doc-function">



<h6 id="frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.get_working_batteries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_working_batteries</span><span class="p">(</span><span class="n">batteries</span><span class="p">)</span></code>

<a href="#frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus.get_working_batteries" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>From the given set of batteries return working batteries.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>batteries</code></td>
          <td class="doc-param-details">
            <div class="doc-md-description">
              <p>Set of batteries</p>
            </div>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><a class="autorefs autorefs-external" title="collections.abc" href="https://docs.python.org/3/library/collections.abc.html#module-collections.abc">abc</a>.<a class="autorefs autorefs-external" title="collections.abc.Set" href="https://docs.python.org/3/library/collections.abc.html#collections.abc.Set">Set</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code><a class="autorefs autorefs-external" title="typing.Set" href="https://docs.python.org/3/library/typing.html#typing.Set">Set</a>[<a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#int">int</a>]</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <div class="doc-md-description">
              <p>Subset with working batteries.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/_battery_pool_status.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_working_batteries</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batteries</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;From the given set of batteries return working batteries.</span>

<span class="sd">    Args:</span>
<span class="sd">        batteries: Set of batteries</span>

<span class="sd">    Returns:</span>
<span class="sd">        Subset with working batteries.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">working</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">working</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">batteries</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">working</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">working</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uncertain</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">batteries</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="frequenz.sdk.actor.power_distributing.Error" class="doc doc-heading">
        <code>frequenz.sdk.actor.power_distributing.Error</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.Error" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="frequenz.sdk.actor.power_distributing.result.Result" href="result/#frequenz.sdk.actor.power_distributing.result.Result">Result</a></code></p>

  
      <p>Result returned when an error occurred and power was not set at all.</p>


        <details class="quote">
          <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/result.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Error</span><span class="p">(</span><span class="n">Result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result returned when an error occurred and power was not set at all.&quot;&quot;&quot;</span>

    <span class="n">msg</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The error message explaining why error happened.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h5 id="frequenz.sdk.actor.power_distributing.Error-attributes">Attributes<a href="#frequenz.sdk.actor.power_distributing.Error-attributes" class="headerlink" title="Permanent link">¤</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.result.Error.msg" class="doc doc-heading">
<code class="highlight language-python"><span class="n">msg</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.result.Error.msg" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>The error message explaining why error happened.</p>
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="frequenz.sdk.actor.power_distributing.OutOfBound" class="doc doc-heading">
        <code>frequenz.sdk.actor.power_distributing.OutOfBound</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.OutOfBound" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><a class="autorefs autorefs-internal" title="frequenz.sdk.actor.power_distributing.result.Result" href="result/#frequenz.sdk.actor.power_distributing.result.Result">Result</a></code></p>

  
      <p>Result returned when the power was not set because it was out of bounds.</p>
<p>This result happens when the originating request was done with
<code>adjust_power = False</code> and the requested power is not within the batteries bounds.</p>


        <details class="quote">
          <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/result.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">OutOfBound</span><span class="p">(</span><span class="n">Result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result returned when the power was not set because it was out of bounds.</span>

<span class="sd">    This result happens when the originating request was done with</span>
<span class="sd">    `adjust_power = False` and the requested power is not within the batteries bounds.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">bound</span><span class="p">:</span> <span class="nb">float</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The total power bound for the requested batteries.</span>

<span class="sd">    If the requested power negative, then this value is the lower bound.</span>
<span class="sd">    Otherwise it is upper bound.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h5 id="frequenz.sdk.actor.power_distributing.OutOfBound-attributes">Attributes<a href="#frequenz.sdk.actor.power_distributing.OutOfBound-attributes" class="headerlink" title="Permanent link">¤</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.result.OutOfBound.bound" class="doc doc-heading">
<code class="highlight language-python"><span class="n">bound</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.result.OutOfBound.bound" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>The total power bound for the requested batteries.</p>
<p>If the requested power negative, then this value is the lower bound.
Otherwise it is upper bound.</p>
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="frequenz.sdk.actor.power_distributing.PartialFailure" class="doc doc-heading">
        <code>frequenz.sdk.actor.power_distributing.PartialFailure</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.PartialFailure" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="frequenz.sdk.actor.power_distributing.result._BaseSuccessMixin">_BaseSuccessMixin</span></code>, <code><a class="autorefs autorefs-internal" title="frequenz.sdk.actor.power_distributing.result.Result" href="result/#frequenz.sdk.actor.power_distributing.result.Result">Result</a></code></p>

  
      <p>Result returned when any battery failed to perform the request.</p>


        <details class="quote">
          <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/result.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">PartialFailure</span><span class="p">(</span><span class="n">_BaseSuccessMixin</span><span class="p">,</span> <span class="n">Result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result returned when any battery failed to perform the request.&quot;&quot;&quot;</span>

    <span class="n">failed_power</span><span class="p">:</span> <span class="nb">float</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The part of the requested power that failed to be set.&quot;&quot;&quot;</span>

    <span class="n">failed_batteries</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The subset of batteries for which the request failed.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h5 id="frequenz.sdk.actor.power_distributing.PartialFailure-attributes">Attributes<a href="#frequenz.sdk.actor.power_distributing.PartialFailure-attributes" class="headerlink" title="Permanent link">¤</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.result.PartialFailure.failed_batteries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">failed_batteries</span><span class="p">:</span> <span class="nb">set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.result.PartialFailure.failed_batteries" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>The subset of batteries for which the request failed.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.result.PartialFailure.failed_power" class="doc doc-heading">
<code class="highlight language-python"><span class="n">failed_power</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.result.PartialFailure.failed_power" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>The part of the requested power that failed to be set.</p>
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="frequenz.sdk.actor.power_distributing.PowerDistributingActor" class="doc doc-heading">
        <code>frequenz.sdk.actor.power_distributing.PowerDistributingActor</code>


<a href="#frequenz.sdk.actor.power_distributing.PowerDistributingActor" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">

  
      <p>Actor to distribute the power between batteries in a microgrid.</p>
<p>The purpose of this tool is to keep an equal SoC level in all batteries.
The PowerDistributingActor can have many concurrent users which at this time
need to be known at construction time.</p>
<p>For each user a bidirectional channel needs to be created through which
they can send and receive requests and responses.</p>
<p>It is recommended to wait for PowerDistributingActor output with timeout. Otherwise if
the processing function fails then the response will never come.
The timeout should be Result:request_timeout_sec + time for processing the request.</p>
<p>Edge cases:
* If there are 2 requests to be processed for the same subset of batteries, then
only the latest request will be processed. Older request will be ignored. User with
older request will get response with Result.Status.IGNORED.</p>
<ul>
<li>If there are 2 requests and their subset of batteries is different but they
overlap (they have at least one common battery), then then both batteries
will be processed. However it is not expected so the proper error log will be
printed.</li>
</ul>

<details class="example" open>
  <summary>Example</summary>
  <div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">frequenz.sdk</span> <span class="kn">import</span> <span class="n">microgrid</span>
<span class="kn">from</span> <span class="nn">frequenz.sdk.microgrid.component</span> <span class="kn">import</span> <span class="n">ComponentCategory</span>
<span class="kn">from</span> <span class="nn">frequenz.sdk.actor</span> <span class="kn">import</span> <span class="n">ResamplerConfig</span>
<span class="kn">from</span> <span class="nn">frequenz.sdk.actor.power_distributing</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">PowerDistributingActor</span><span class="p">,</span>
    <span class="n">Request</span><span class="p">,</span>
    <span class="n">Result</span><span class="p">,</span>
    <span class="n">Success</span><span class="p">,</span>
    <span class="n">Error</span><span class="p">,</span>
    <span class="n">PartialFailure</span><span class="p">,</span>
    <span class="n">Ignored</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">frequenz.channels</span> <span class="kn">import</span> <span class="n">Broadcast</span><span class="p">,</span> <span class="n">Receiver</span><span class="p">,</span> <span class="n">Sender</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">frequenz.sdk</span> <span class="kn">import</span> <span class="n">actor</span>

<span class="n">HOST</span> <span class="o">=</span> <span class="s2">&quot;localhost&quot;</span>
<span class="n">PORT</span> <span class="o">=</span> <span class="mi">50051</span>

<span class="k">await</span> <span class="n">microgrid</span><span class="o">.</span><span class="n">initialize</span><span class="p">(</span>
    <span class="n">HOST</span><span class="p">,</span>
    <span class="n">PORT</span><span class="p">,</span>
    <span class="n">ResamplerConfig</span><span class="p">(</span><span class="n">resampling_period</span><span class="o">=</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="p">)</span>

<span class="n">graph</span> <span class="o">=</span> <span class="n">microgrid</span><span class="o">.</span><span class="n">connection_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">component_graph</span>

<span class="n">batteries</span> <span class="o">=</span> <span class="n">graph</span><span class="o">.</span><span class="n">components</span><span class="p">(</span><span class="n">component_category</span><span class="o">=</span><span class="p">{</span><span class="n">ComponentCategory</span><span class="o">.</span><span class="n">BATTERY</span><span class="p">})</span>
<span class="n">batteries_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">c</span><span class="o">.</span><span class="n">component_id</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">batteries</span><span class="p">}</span>

<span class="n">battery_status_channel</span> <span class="o">=</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">BatteryStatus</span><span class="p">](</span><span class="s2">&quot;battery-status&quot;</span><span class="p">)</span>

<span class="n">channel</span> <span class="o">=</span> <span class="n">Broadcast</span><span class="p">[</span><span class="n">Request</span><span class="p">](</span><span class="s2">&quot;power_distributor&quot;</span><span class="p">)</span>
<span class="n">channel_registry</span> <span class="o">=</span> <span class="n">ChannelRegistry</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;power_distributor&quot;</span><span class="p">)</span>
<span class="n">power_distributor</span> <span class="o">=</span> <span class="n">PowerDistributingActor</span><span class="p">(</span>
    <span class="n">requests_receiver</span><span class="o">=</span><span class="n">channel</span><span class="o">.</span><span class="n">new_receiver</span><span class="p">(),</span>
    <span class="n">channel_registry</span><span class="o">=</span><span class="n">channel_registry</span><span class="p">,</span>
    <span class="n">battery_status_sender</span><span class="o">=</span><span class="n">battery_status_channel</span><span class="o">.</span><span class="n">new_sender</span><span class="p">(),</span>
<span class="p">)</span>

<span class="n">sender</span> <span class="o">=</span> <span class="n">channel</span><span class="o">.</span><span class="n">new_sender</span><span class="p">()</span>
<span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;namespace&quot;</span>
<span class="c1"># Set power 1200W to given batteries.</span>
<span class="n">request</span> <span class="o">=</span> <span class="n">Request</span><span class="p">(</span>
    <span class="n">namespace</span><span class="o">=</span><span class="n">namespace</span><span class="p">,</span>
    <span class="n">power</span><span class="o">=</span><span class="mf">1200.0</span><span class="p">,</span>
    <span class="n">batteries</span><span class="o">=</span><span class="n">batteries_ids</span><span class="p">,</span>
    <span class="n">request_timeout_sec</span><span class="o">=</span><span class="mf">10.0</span>
<span class="p">)</span>
<span class="k">await</span> <span class="n">sender</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="n">result_rx</span> <span class="o">=</span> <span class="n">channel_registry</span><span class="o">.</span><span class="n">new_receiver</span><span class="p">(</span><span class="n">namespace</span><span class="p">)</span>

<span class="c1"># It is recommended to use timeout when waiting for the response!</span>
<span class="n">result</span><span class="p">:</span> <span class="n">Result</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait_for</span><span class="p">(</span><span class="n">result_rx</span><span class="o">.</span><span class="n">receive</span><span class="p">(),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Success</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Command succeed&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">PartialFailure</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Batteries </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">failed_batteries</span><span class="si">}</span><span class="s2"> failed, total failed power&quot;</span>                 <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">failed_power</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="p">)</span>
<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Ignored</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request was ignored, because of newer request&quot;</span><span class="p">)</span>
<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">Error</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Request failed with error: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">msg</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
</details>

        <details class="quote">
          <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/power_distributing.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@actor</span>
<span class="k">class</span> <span class="nc">PowerDistributingActor</span><span class="p">:</span>
    <span class="c1"># pylint: disable=too-many-instance-attributes</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Actor to distribute the power between batteries in a microgrid.</span>

<span class="sd">    The purpose of this tool is to keep an equal SoC level in all batteries.</span>
<span class="sd">    The PowerDistributingActor can have many concurrent users which at this time</span>
<span class="sd">    need to be known at construction time.</span>

<span class="sd">    For each user a bidirectional channel needs to be created through which</span>
<span class="sd">    they can send and receive requests and responses.</span>

<span class="sd">    It is recommended to wait for PowerDistributingActor output with timeout. Otherwise if</span>
<span class="sd">    the processing function fails then the response will never come.</span>
<span class="sd">    The timeout should be Result:request_timeout_sec + time for processing the request.</span>

<span class="sd">    Edge cases:</span>
<span class="sd">    * If there are 2 requests to be processed for the same subset of batteries, then</span>
<span class="sd">    only the latest request will be processed. Older request will be ignored. User with</span>
<span class="sd">    older request will get response with Result.Status.IGNORED.</span>

<span class="sd">    * If there are 2 requests and their subset of batteries is different but they</span>
<span class="sd">    overlap (they have at least one common battery), then then both batteries</span>
<span class="sd">    will be processed. However it is not expected so the proper error log will be</span>
<span class="sd">    printed.</span>

<span class="sd">    Example:</span>
<span class="sd">        ```python</span>
<span class="sd">        from frequenz.sdk import microgrid</span>
<span class="sd">        from frequenz.sdk.microgrid.component import ComponentCategory</span>
<span class="sd">        from frequenz.sdk.actor import ResamplerConfig</span>
<span class="sd">        from frequenz.sdk.actor.power_distributing import (</span>
<span class="sd">            PowerDistributingActor,</span>
<span class="sd">            Request,</span>
<span class="sd">            Result,</span>
<span class="sd">            Success,</span>
<span class="sd">            Error,</span>
<span class="sd">            PartialFailure,</span>
<span class="sd">            Ignored,</span>
<span class="sd">        )</span>
<span class="sd">        from frequenz.channels import Broadcast, Receiver, Sender</span>
<span class="sd">        from datetime import timedelta</span>
<span class="sd">        from frequenz.sdk import actor</span>

<span class="sd">        HOST = &quot;localhost&quot;</span>
<span class="sd">        PORT = 50051</span>

<span class="sd">        await microgrid.initialize(</span>
<span class="sd">            HOST,</span>
<span class="sd">            PORT,</span>
<span class="sd">            ResamplerConfig(resampling_period=timedelta(seconds=1))</span>
<span class="sd">        )</span>

<span class="sd">        graph = microgrid.connection_manager.get().component_graph</span>

<span class="sd">        batteries = graph.components(component_category={ComponentCategory.BATTERY})</span>
<span class="sd">        batteries_ids = {c.component_id for c in batteries}</span>

<span class="sd">        battery_status_channel = Broadcast[BatteryStatus](&quot;battery-status&quot;)</span>

<span class="sd">        channel = Broadcast[Request](&quot;power_distributor&quot;)</span>
<span class="sd">        channel_registry = ChannelRegistry(name=&quot;power_distributor&quot;)</span>
<span class="sd">        power_distributor = PowerDistributingActor(</span>
<span class="sd">            requests_receiver=channel.new_receiver(),</span>
<span class="sd">            channel_registry=channel_registry,</span>
<span class="sd">            battery_status_sender=battery_status_channel.new_sender(),</span>
<span class="sd">        )</span>

<span class="sd">        sender = channel.new_sender()</span>
<span class="sd">        namespace: str = &quot;namespace&quot;</span>
<span class="sd">        # Set power 1200W to given batteries.</span>
<span class="sd">        request = Request(</span>
<span class="sd">            namespace=namespace,</span>
<span class="sd">            power=1200.0,</span>
<span class="sd">            batteries=batteries_ids,</span>
<span class="sd">            request_timeout_sec=10.0</span>
<span class="sd">        )</span>
<span class="sd">        await sender.send(request)</span>
<span class="sd">        result_rx = channel_registry.new_receiver(namespace)</span>

<span class="sd">        # It is recommended to use timeout when waiting for the response!</span>
<span class="sd">        result: Result = await asyncio.wait_for(result_rx.receive(), timeout=10)</span>

<span class="sd">        if isinstance(result, Success):</span>
<span class="sd">            print(&quot;Command succeed&quot;)</span>
<span class="sd">        elif isinstance(result, PartialFailure):</span>
<span class="sd">            print(</span>
<span class="sd">                f&quot;Batteries {result.failed_batteries} failed, total failed power&quot; \</span>
<span class="sd">                f&quot;{result.failed_power}&quot;</span>
<span class="sd">            )</span>
<span class="sd">        elif isinstance(result, Ignored):</span>
<span class="sd">            print(&quot;Request was ignored, because of newer request&quot;)</span>
<span class="sd">        elif isinstance(result, Error):</span>
<span class="sd">            print(f&quot;Request failed with error: {result.msg}&quot;)</span>
<span class="sd">        ```</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">requests_receiver</span><span class="p">:</span> <span class="n">Receiver</span><span class="p">[</span><span class="n">Request</span><span class="p">],</span>
        <span class="n">channel_registry</span><span class="p">:</span> <span class="n">ChannelRegistry</span><span class="p">,</span>
        <span class="n">battery_status_sender</span><span class="p">:</span> <span class="n">Sender</span><span class="p">[</span><span class="n">BatteryStatus</span><span class="p">],</span>
        <span class="n">wait_for_data_sec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create class instance.</span>

<span class="sd">        Args:</span>
<span class="sd">            requests_receiver: Receiver for receiving power requests from other actors.</span>
<span class="sd">            channel_registry: Channel registry for creating result channels dynamically</span>
<span class="sd">                for each request namespace.</span>
<span class="sd">            battery_status_sender: Channel for sending information which batteries are</span>
<span class="sd">                working.</span>
<span class="sd">            wait_for_data_sec: How long actor should wait before processing first</span>
<span class="sd">                request. It is a time needed to collect first components data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requests_receiver</span> <span class="o">=</span> <span class="n">requests_receiver</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channel_registry</span> <span class="o">=</span> <span class="n">channel_registry</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_data_sec</span> <span class="o">=</span> <span class="n">wait_for_data_sec</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_result_senders</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sender</span><span class="p">[</span><span class="n">Result</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dictionary of result senders for each request namespace.</span>

<span class="sd">        They are for channels owned by the channel registry, we just hold a reference</span>
<span class="sd">        to their senders, for fast access.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># NOTE: power_distributor_exponent should be received from ConfigManager</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power_distributor_exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distribution_algorithm</span> <span class="o">=</span> <span class="n">DistributionAlgorithm</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">power_distributor_exponent</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_bat_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_components_pairs</span><span class="p">(</span>
            <span class="n">connection_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">component_graph</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_battery_receivers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Peekable</span><span class="p">[</span><span class="n">BatteryData</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_inverter_receivers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Peekable</span><span class="p">[</span><span class="n">InverterData</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_all_battery_status</span> <span class="o">=</span> <span class="n">BatteryPoolStatus</span><span class="p">(</span>
            <span class="n">battery_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="n">battery_status_sender</span><span class="o">=</span><span class="n">battery_status_sender</span><span class="p">,</span>
            <span class="n">max_blocking_duration_sec</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
            <span class="n">max_data_age_sec</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_CacheEntry</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">bat_id</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">bat_id</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span> <span class="nf">_get_upper_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batteries</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">include_broken</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get total upper bound of power to be set for given batteries.</span>

<span class="sd">        Note, output of that function doesn&#39;t guarantee that this bound will be</span>
<span class="sd">        the same when the request is processed.</span>

<span class="sd">        Args:</span>
<span class="sd">            batteries: List of batteries</span>
<span class="sd">            include_broken: whether all batteries in the batteries set in the</span>
<span class="sd">                request must be used regardless the status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Upper bound for `set_power` operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pairs_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InvBatPair</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_components_data</span><span class="p">(</span>
            <span class="n">batteries</span><span class="p">,</span> <span class="n">include_broken</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="nb">min</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">power_upper_bound</span><span class="p">,</span> <span class="n">inverter</span><span class="o">.</span><span class="n">active_power_upper_bound</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">battery</span><span class="p">,</span> <span class="n">inverter</span> <span class="ow">in</span> <span class="n">pairs_data</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_lower_bound</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batteries</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">include_broken</span><span class="p">:</span> <span class="nb">bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get total lower bound of power to be set for given batteries.</span>

<span class="sd">        Note, output of that function doesn&#39;t guarantee that this bound will be</span>
<span class="sd">        the same when the request is processed.</span>

<span class="sd">        Args:</span>
<span class="sd">            batteries: List of batteries</span>
<span class="sd">            include_broken: whether all batteries in the batteries set in the</span>
<span class="sd">                request must be used regardless the status.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Lower bound for `set_power` operation.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pairs_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InvBatPair</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_components_data</span><span class="p">(</span>
            <span class="n">batteries</span><span class="p">,</span> <span class="n">include_broken</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span>
            <span class="nb">max</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">power_lower_bound</span><span class="p">,</span> <span class="n">inverter</span><span class="o">.</span><span class="n">active_power_lower_bound</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">battery</span><span class="p">,</span> <span class="n">inverter</span> <span class="ow">in</span> <span class="n">pairs_data</span>
        <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_send_result</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">result</span><span class="p">:</span> <span class="n">Result</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send result to the user.</span>

<span class="sd">        Args:</span>
<span class="sd">            namespace: namespace of the sender, to identify the result channel with.</span>
<span class="sd">            result: Result to send out.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">namespace</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_senders</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_result_senders</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel_registry</span><span class="o">.</span><span class="n">new_sender</span><span class="p">(</span>
                <span class="n">namespace</span>
            <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_result_senders</span><span class="p">[</span><span class="n">namespace</span><span class="p">]</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run actor main function.</span>

<span class="sd">        It waits for new requests in task_queue and process it, and send</span>
<span class="sd">        `set_power` request with distributed power.</span>
<span class="sd">        The output of the `set_power` method is processed.</span>
<span class="sd">        Every battery and inverter that failed or didn&#39;t respond in time will be marked</span>
<span class="sd">        as broken for some time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_channels</span><span class="p">()</span>

        <span class="n">api</span> <span class="o">=</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">api_client</span>

        <span class="c1"># Wait few seconds to get data from the channels created above.</span>
        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_data_sec</span><span class="p">)</span>

        <span class="k">async</span> <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requests_receiver</span><span class="p">:</span>
            <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">pairs_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InvBatPair</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_components_data</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">batteries</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">include_broken_batteries</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">pairs_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">include_broken_batteries</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No data for the given batteries </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">batteries</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_power_distribution</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pairs_data</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t distribute power, error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">distributed_power_value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">power</span> <span class="o">-</span> <span class="n">distribution</span><span class="o">.</span><span class="n">remaining_power</span>
            <span class="n">battery_distribution</span> <span class="o">=</span> <span class="p">{</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_inv_bat_map</span><span class="p">[</span><span class="n">bat_id</span><span class="p">]:</span> <span class="n">dist</span>
                <span class="k">for</span> <span class="n">bat_id</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">distribution</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="s2">&quot;Distributing power </span><span class="si">%d</span><span class="s2"> between the batteries </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">distributed_power_value</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">battery_distribution</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="n">failed_power</span><span class="p">,</span> <span class="n">failed_batteries</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_distributed_power</span><span class="p">(</span>
                <span class="n">api</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">request_timeout_sec</span>
            <span class="p">)</span>

            <span class="n">response</span><span class="p">:</span> <span class="n">Success</span> <span class="o">|</span> <span class="n">PartialFailure</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_batteries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">succeed_batteries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">battery_distribution</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">failed_batteries</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">PartialFailure</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                    <span class="n">succeeded_power</span><span class="o">=</span><span class="n">distributed_power_value</span><span class="p">,</span>
                    <span class="n">succeeded_batteries</span><span class="o">=</span><span class="n">succeed_batteries</span><span class="p">,</span>
                    <span class="n">failed_power</span><span class="o">=</span><span class="n">failed_power</span><span class="p">,</span>
                    <span class="n">failed_batteries</span><span class="o">=</span><span class="n">failed_batteries</span><span class="p">,</span>
                    <span class="n">excess_power</span><span class="o">=</span><span class="n">distribution</span><span class="o">.</span><span class="n">remaining_power</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">succeed_batteries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">battery_distribution</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                <span class="n">response</span> <span class="o">=</span> <span class="n">Success</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                    <span class="n">succeeded_power</span><span class="o">=</span><span class="n">distributed_power_value</span><span class="p">,</span>
                    <span class="n">succeeded_batteries</span><span class="o">=</span><span class="n">succeed_batteries</span><span class="p">,</span>
                    <span class="n">excess_power</span><span class="o">=</span><span class="n">distribution</span><span class="o">.</span><span class="n">remaining_power</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
                <span class="o">*</span><span class="p">[</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_all_battery_status</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span>
                        <span class="n">succeed_batteries</span><span class="p">,</span> <span class="n">failed_batteries</span>
                    <span class="p">),</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">response</span><span class="p">),</span>
                <span class="p">]</span>
            <span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_set_distributed_power</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">api</span><span class="p">:</span> <span class="n">MicrogridApiClient</span><span class="p">,</span>
        <span class="n">distribution</span><span class="p">:</span> <span class="n">DistributionResult</span><span class="p">,</span>
        <span class="n">timeout_sec</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Send distributed power to the inverters.</span>

<span class="sd">        Args:</span>
<span class="sd">            api: Microgrid api client</span>
<span class="sd">            distribution: Distribution result</span>
<span class="sd">            timeout_sec: How long wait for the response</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple where first element is total failed power, and the second element</span>
<span class="sd">            set of batteries that failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">tasks</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">inverter_id</span><span class="p">:</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">create_task</span><span class="p">(</span><span class="n">api</span><span class="o">.</span><span class="n">set_power</span><span class="p">(</span><span class="n">inverter_id</span><span class="p">,</span> <span class="n">power</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">inverter_id</span><span class="p">,</span> <span class="n">power</span> <span class="ow">in</span> <span class="n">distribution</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="n">_</span><span class="p">,</span> <span class="n">pending</span> <span class="o">=</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">wait</span><span class="p">(</span>
            <span class="n">tasks</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
            <span class="n">timeout</span><span class="o">=</span><span class="n">timeout_sec</span><span class="p">,</span>
            <span class="n">return_when</span><span class="o">=</span><span class="n">ALL_COMPLETED</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cancel_tasks</span><span class="p">(</span><span class="n">pending</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_result</span><span class="p">(</span><span class="n">tasks</span><span class="p">,</span> <span class="n">distribution</span><span class="o">.</span><span class="n">distribution</span><span class="p">,</span> <span class="n">timeout_sec</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_power_distribution</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">,</span> <span class="n">inv_bat_pairs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InvBatPair</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DistributionResult</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get power distribution result for the batteries in the request.</span>

<span class="sd">        Args:</span>
<span class="sd">            request: the power request to process.</span>
<span class="sd">            inv_bat_pairs: the battery and adjacent inverter data pairs.</span>

<span class="sd">        Returns:</span>
<span class="sd">            the power distribution result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">available_bat_ids</span> <span class="o">=</span> <span class="p">{</span><span class="n">battery</span><span class="o">.</span><span class="n">component_id</span> <span class="k">for</span> <span class="n">battery</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">inv_bat_pairs</span><span class="p">}</span>
        <span class="n">unavailable_bat_ids</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">batteries</span> <span class="o">-</span> <span class="n">available_bat_ids</span>
        <span class="n">unavailable_inv_ids</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="p">[</span><span class="n">battery_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">battery_id</span> <span class="ow">in</span> <span class="n">unavailable_bat_ids</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">include_broken_batteries</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">available_bat_ids</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution_algorithm</span><span class="o">.</span><span class="n">distribute_power_equally</span><span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">power</span><span class="p">,</span> <span class="n">unavailable_inv_ids</span>
            <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution_algorithm</span><span class="o">.</span><span class="n">distribute_power</span><span class="p">(</span>
            <span class="n">request</span><span class="o">.</span><span class="n">power</span><span class="p">,</span> <span class="n">inv_bat_pairs</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">include_broken_batteries</span> <span class="ow">and</span> <span class="n">unavailable_inv_ids</span><span class="p">:</span>
            <span class="n">additional_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution_algorithm</span><span class="o">.</span><span class="n">distribute_power_equally</span><span class="p">(</span>
                <span class="n">result</span><span class="o">.</span><span class="n">remaining_power</span><span class="p">,</span> <span class="n">unavailable_inv_ids</span>
            <span class="p">)</span>

            <span class="k">for</span> <span class="n">inv_id</span><span class="p">,</span> <span class="n">power</span> <span class="ow">in</span> <span class="n">additional_result</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">result</span><span class="o">.</span><span class="n">distribution</span><span class="p">[</span><span class="n">inv_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">power</span>
            <span class="n">result</span><span class="o">.</span><span class="n">remaining_power</span> <span class="o">=</span> <span class="mf">0.0</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">_check_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">Request</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Result</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check whether the given request if correct.</span>

<span class="sd">        Args:</span>
<span class="sd">            request: request to check</span>

<span class="sd">        Returns:</span>
<span class="sd">            Result for the user if the request is wrong, None otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">batteries</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Empty battery IDs in the request&quot;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">battery</span> <span class="ow">in</span> <span class="n">request</span><span class="o">.</span><span class="n">batteries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">battery</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_battery_receivers</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">=</span> <span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No battery </span><span class="si">{</span><span class="n">battery</span><span class="si">}</span><span class="s2">, available batteries: &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_battery_receivers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">Error</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">msg</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">adjust_power</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">power</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">bound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_lower_bound</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">batteries</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">include_broken_batteries</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">power</span> <span class="o">&lt;</span> <span class="n">bound</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">OutOfBound</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">bound</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bound</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_upper_bound</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">batteries</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">include_broken_batteries</span>
                <span class="p">)</span>
                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">power</span> <span class="o">&gt;</span> <span class="n">bound</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">OutOfBound</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">bound</span><span class="o">=</span><span class="n">bound</span><span class="p">)</span>

        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_components_pairs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">component_graph</span><span class="p">:</span> <span class="n">ComponentGraph</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create maps between battery and adjacent inverter.</span>

<span class="sd">        Args:</span>
<span class="sd">            component_graph: component graph</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple where first element is map between battery and adjacent inverter,</span>
<span class="sd">                second element of the tuple is map between inverter and adjacent</span>
<span class="sd">                battery.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">bat_inv_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">inv_bat_map</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">batteries</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">Component</span><span class="p">]</span> <span class="o">=</span> <span class="n">component_graph</span><span class="o">.</span><span class="n">components</span><span class="p">(</span>
            <span class="n">component_category</span><span class="o">=</span><span class="p">{</span><span class="n">ComponentCategory</span><span class="o">.</span><span class="n">BATTERY</span><span class="p">}</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">battery</span> <span class="ow">in</span> <span class="n">batteries</span><span class="p">:</span>
            <span class="n">inverters</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Component</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">component</span>
                <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">component_graph</span><span class="o">.</span><span class="n">predecessors</span><span class="p">(</span><span class="n">battery</span><span class="o">.</span><span class="n">component_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">component</span><span class="o">.</span><span class="n">category</span> <span class="o">==</span> <span class="n">ComponentCategory</span><span class="o">.</span><span class="n">INVERTER</span>
            <span class="p">]</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inverters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No inverters for battery </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">battery</span><span class="o">.</span><span class="n">component_id</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">inverters</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="s2">&quot;Battery </span><span class="si">%d</span><span class="s2"> has more then one inverter. It is not supported now.&quot;</span><span class="p">,</span>
                    <span class="n">battery</span><span class="o">.</span><span class="n">component_id</span><span class="p">,</span>
                <span class="p">)</span>

            <span class="n">bat_inv_map</span><span class="p">[</span><span class="n">battery</span><span class="o">.</span><span class="n">component_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">inverters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">component_id</span>
            <span class="n">inv_bat_map</span><span class="p">[</span><span class="n">inverters</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">component_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">battery</span><span class="o">.</span><span class="n">component_id</span>

        <span class="k">return</span> <span class="n">bat_inv_map</span><span class="p">,</span> <span class="n">inv_bat_map</span>

    <span class="k">def</span> <span class="nf">_get_components_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">batteries</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">include_broken</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">InvBatPair</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get data for the given batteries and adjacent inverters.</span>

<span class="sd">        Args:</span>
<span class="sd">            batteries: Batteries that needs data.</span>
<span class="sd">            include_broken: whether all batteries in the batteries set in the</span>
<span class="sd">                request must be used regardless the status.</span>

<span class="sd">        Raises:</span>
<span class="sd">            KeyError: If any battery in the given list doesn&#39;t exists in microgrid.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Pairs of battery and adjacent inverter data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pairs_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InvBatPair</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">working_batteries</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">batteries</span>
            <span class="k">if</span> <span class="n">include_broken</span>
            <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_battery_status</span><span class="o">.</span><span class="n">get_working_batteries</span><span class="p">(</span><span class="n">batteries</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">for</span> <span class="n">battery_id</span> <span class="ow">in</span> <span class="n">working_batteries</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">battery_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_battery_receivers</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;No battery </span><span class="si">{</span><span class="n">battery_id</span><span class="si">}</span><span class="s2">, &quot;</span>
                    <span class="sa">f</span><span class="s2">&quot;available batteries: </span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_battery_receivers</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

            <span class="n">inverter_id</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="p">[</span><span class="n">battery_id</span><span class="p">]</span>

            <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_battery_inverter_data</span><span class="p">(</span><span class="n">battery_id</span><span class="p">,</span> <span class="n">inverter_id</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">and</span> <span class="n">include_broken</span><span class="p">:</span>
                <span class="n">cached_entry</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_cached_metrics</span><span class="p">[</span><span class="n">battery_id</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">cached_entry</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">cached_entry</span><span class="o">.</span><span class="n">has_expired</span><span class="p">():</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="n">cached_entry</span><span class="o">.</span><span class="n">inv_bat_pair</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">data</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Skipping battery </span><span class="si">%d</span><span class="s2"> because its message isn&#39;t correct.&quot;</span><span class="p">,</span>
                    <span class="n">battery_id</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="k">continue</span>

            <span class="n">pairs_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">pairs_data</span>

    <span class="k">def</span> <span class="nf">_get_battery_inverter_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">battery_id</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">inverter_id</span><span class="p">:</span> <span class="nb">int</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">InvBatPair</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get battery and inverter data if they are correct.</span>

<span class="sd">        Each float data from the microgrid can be &quot;NaN&quot;.</span>
<span class="sd">        We can&#39;t do math operations on &quot;NaN&quot;.</span>
<span class="sd">        So check all the metrics and:</span>
<span class="sd">        * if power bounds are NaN, then try to replace it with the corresponding</span>
<span class="sd">          power bounds from the adjacent component. If metric in the adjacent component</span>
<span class="sd">          is also NaN, then return None.</span>
<span class="sd">        * if other metrics are NaN then return None. We can&#39;t assume anything for other</span>
<span class="sd">          metrics.</span>

<span class="sd">        Args:</span>
<span class="sd">            battery_id: battery id</span>
<span class="sd">            inverter_id: inverter id</span>

<span class="sd">        Returns:</span>
<span class="sd">            Data for the battery and adjacent inverter without NaN values.</span>
<span class="sd">                Return None if we could not replace NaN values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">battery_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_battery_receivers</span><span class="p">[</span><span class="n">battery_id</span><span class="p">]</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>
        <span class="n">inverter_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inverter_receivers</span><span class="p">[</span><span class="n">inverter_id</span><span class="p">]</span><span class="o">.</span><span class="n">peek</span><span class="p">()</span>

        <span class="c1"># It means that nothing has been send on this channels, yet.</span>
        <span class="c1"># This should be handled by BatteryStatus. BatteryStatus should not return</span>
        <span class="c1"># this batteries as working.</span>
        <span class="k">if</span> <span class="n">battery_data</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">inverter_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Battery </span><span class="si">%d</span><span class="s2"> or inverter </span><span class="si">%d</span><span class="s2"> send no data, yet. They should be not used.&quot;</span><span class="p">,</span>
                <span class="n">battery_id</span><span class="p">,</span>
                <span class="n">inverter_id</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">not_replaceable_metrics</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">battery_data</span><span class="o">.</span><span class="n">soc</span><span class="p">,</span>
            <span class="n">battery_data</span><span class="o">.</span><span class="n">soc_lower_bound</span><span class="p">,</span>
            <span class="n">battery_data</span><span class="o">.</span><span class="n">soc_upper_bound</span><span class="p">,</span>
            <span class="c1"># We could replace capacity with 0, but it won&#39;t change distribution.</span>
            <span class="c1"># This battery will be ignored in distribution anyway.</span>
            <span class="n">battery_data</span><span class="o">.</span><span class="n">capacity</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">isnan</span><span class="p">,</span> <span class="n">not_replaceable_metrics</span><span class="p">)):</span>
            <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Some metrics for battery </span><span class="si">%d</span><span class="s2"> are NaN&quot;</span><span class="p">,</span> <span class="n">battery_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">replaceable_metrics</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">battery_data</span><span class="o">.</span><span class="n">power_lower_bound</span><span class="p">,</span>
            <span class="n">battery_data</span><span class="o">.</span><span class="n">power_upper_bound</span><span class="p">,</span>
            <span class="n">inverter_data</span><span class="o">.</span><span class="n">active_power_lower_bound</span><span class="p">,</span>
            <span class="n">inverter_data</span><span class="o">.</span><span class="n">active_power_upper_bound</span><span class="p">,</span>
        <span class="p">]</span>

        <span class="c1"># If all values are ok then return them.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">any</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">isnan</span><span class="p">,</span> <span class="n">replaceable_metrics</span><span class="p">)):</span>
            <span class="n">inv_bat_pair</span> <span class="o">=</span> <span class="n">InvBatPair</span><span class="p">(</span><span class="n">battery_data</span><span class="p">,</span> <span class="n">inverter_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_cached_metrics</span><span class="p">[</span><span class="n">battery_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CacheEntry</span><span class="o">.</span><span class="n">from_ttl</span><span class="p">(</span><span class="n">inv_bat_pair</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">inv_bat_pair</span>

        <span class="c1"># Replace NaN with the corresponding value in the adjacent component.</span>
        <span class="c1"># If both metrics are None, return None to ignore this battery.</span>
        <span class="n">replaceable_pairs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;power_lower_bound&quot;</span><span class="p">,</span> <span class="s2">&quot;active_power_lower_bound&quot;</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;power_upper_bound&quot;</span><span class="p">,</span> <span class="s2">&quot;active_power_upper_bound&quot;</span><span class="p">),</span>
        <span class="p">]</span>

        <span class="n">battery_new_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">inverter_new_metrics</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">bat_attr</span><span class="p">,</span> <span class="n">inv_attr</span> <span class="ow">in</span> <span class="n">replaceable_pairs</span><span class="p">:</span>
            <span class="n">bat_bound</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">battery_data</span><span class="p">,</span> <span class="n">bat_attr</span><span class="p">)</span>
            <span class="n">inv_bound</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">inverter_data</span><span class="p">,</span> <span class="n">inv_attr</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">isnan</span><span class="p">(</span><span class="n">bat_bound</span><span class="p">)</span> <span class="ow">and</span> <span class="n">isnan</span><span class="p">(</span><span class="n">inv_bound</span><span class="p">):</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Some metrics for battery </span><span class="si">%d</span><span class="s2"> are NaN&quot;</span><span class="p">,</span> <span class="n">battery_id</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">isnan</span><span class="p">(</span><span class="n">bat_bound</span><span class="p">):</span>
                <span class="n">battery_new_metrics</span><span class="p">[</span><span class="n">bat_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv_bound</span>
            <span class="k">elif</span> <span class="n">isnan</span><span class="p">(</span><span class="n">inv_bound</span><span class="p">):</span>
                <span class="n">inverter_new_metrics</span><span class="p">[</span><span class="n">inv_attr</span><span class="p">]</span> <span class="o">=</span> <span class="n">bat_bound</span>

        <span class="n">inv_bat_pair</span> <span class="o">=</span> <span class="n">InvBatPair</span><span class="p">(</span>
            <span class="n">replace</span><span class="p">(</span><span class="n">battery_data</span><span class="p">,</span> <span class="o">**</span><span class="n">battery_new_metrics</span><span class="p">),</span>
            <span class="n">replace</span><span class="p">(</span><span class="n">inverter_data</span><span class="p">,</span> <span class="o">**</span><span class="n">inverter_new_metrics</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_cached_metrics</span><span class="p">[</span><span class="n">battery_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">_CacheEntry</span><span class="o">.</span><span class="n">from_ttl</span><span class="p">(</span><span class="n">inv_bat_pair</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">inv_bat_pair</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_create_channels</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create channels to get data of components in microgrid.&quot;&quot;&quot;</span>
        <span class="n">api</span> <span class="o">=</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">api_client</span>
        <span class="k">for</span> <span class="n">battery_id</span><span class="p">,</span> <span class="n">inverter_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">bat_recv</span><span class="p">:</span> <span class="n">Receiver</span><span class="p">[</span><span class="n">BatteryData</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">battery_data</span><span class="p">(</span><span class="n">battery_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_battery_receivers</span><span class="p">[</span><span class="n">battery_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">bat_recv</span><span class="o">.</span><span class="n">into_peekable</span><span class="p">()</span>

            <span class="n">inv_recv</span><span class="p">:</span> <span class="n">Receiver</span><span class="p">[</span><span class="n">InverterData</span><span class="p">]</span> <span class="o">=</span> <span class="k">await</span> <span class="n">api</span><span class="o">.</span><span class="n">inverter_data</span><span class="p">(</span><span class="n">inverter_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inverter_receivers</span><span class="p">[</span><span class="n">inverter_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">inv_recv</span><span class="o">.</span><span class="n">into_peekable</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_parse_result</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="c1"># type comment to quiet pylint and mypy `unused-import` error</span>
        <span class="n">tasks</span><span class="p">,</span>  <span class="c1"># type: Dict[int, asyncio.Task[Empty]]</span>
        <span class="n">distribution</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">request_timeout_sec</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Parse the results of `set_power` requests.</span>

<span class="sd">        Check if any task has failed and determine the reason for failure.</span>
<span class="sd">        If any task did not succeed, then the corresponding battery is marked as broken.</span>

<span class="sd">        Args:</span>
<span class="sd">            tasks: A dictionary where the key is the inverter ID and the value is the task that</span>
<span class="sd">                set the power for this inverter. Each task should be finished or cancelled.</span>
<span class="sd">            distribution: A dictionary where the key is the inverter ID and the value is how much</span>
<span class="sd">                power was set to the corresponding inverter.</span>
<span class="sd">            request_timeout_sec: The timeout that was used for the request.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A tuple where the first element is the total failed power, and the second element is</span>
<span class="sd">            the set of batteries that failed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">failed_power</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">failed_batteries</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">inverter_id</span><span class="p">,</span> <span class="n">aws</span> <span class="ow">in</span> <span class="n">tasks</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">battery_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_bat_map</span><span class="p">[</span><span class="n">inverter_id</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">aws</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
            <span class="k">except</span> <span class="n">grpc</span><span class="o">.</span><span class="n">aio</span><span class="o">.</span><span class="n">AioRpcError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="n">failed_power</span> <span class="o">+=</span> <span class="n">distribution</span><span class="p">[</span><span class="n">inverter_id</span><span class="p">]</span>
                <span class="n">failed_batteries</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">battery_id</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">err</span><span class="o">.</span><span class="n">code</span><span class="p">()</span> <span class="o">==</span> <span class="n">grpc</span><span class="o">.</span><span class="n">StatusCode</span><span class="o">.</span><span class="n">OUT_OF_RANGE</span><span class="p">:</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                        <span class="s2">&quot;Set power for battery </span><span class="si">%d</span><span class="s2"> failed, error </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                        <span class="n">battery_id</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span>
                    <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Set power for battery </span><span class="si">%d</span><span class="s2"> failed, error </span><span class="si">%s</span><span class="s2">. Mark it as broken.&quot;</span><span class="p">,</span>
                        <span class="n">battery_id</span><span class="p">,</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">),</span>
                    <span class="p">)</span>
            <span class="k">except</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">CancelledError</span><span class="p">:</span>
                <span class="n">failed_power</span> <span class="o">+=</span> <span class="n">distribution</span><span class="p">[</span><span class="n">inverter_id</span><span class="p">]</span>
                <span class="n">failed_batteries</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">battery_id</span><span class="p">)</span>
                <span class="n">_logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="s2">&quot;Battery </span><span class="si">%d</span><span class="s2"> didn&#39;t respond in </span><span class="si">%f</span><span class="s2"> sec. Mark it as broken.&quot;</span><span class="p">,</span>
                    <span class="n">battery_id</span><span class="p">,</span>
                    <span class="n">request_timeout_sec</span><span class="p">,</span>
                <span class="p">)</span>

        <span class="k">return</span> <span class="n">failed_power</span><span class="p">,</span> <span class="n">failed_batteries</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_cancel_tasks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tasks</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="n">asyncio</span><span class="o">.</span><span class="n">Task</span><span class="p">[</span><span class="n">Any</span><span class="p">]])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cancel given asyncio tasks and wait for them.</span>

<span class="sd">        Args:</span>
<span class="sd">            tasks: tasks to cancel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">aws</span> <span class="ow">in</span> <span class="n">tasks</span><span class="p">:</span>
            <span class="n">aws</span><span class="o">.</span><span class="n">cancel</span><span class="p">()</span>

        <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span><span class="o">*</span><span class="n">tasks</span><span class="p">,</span> <span class="n">return_exceptions</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">def</span> <span class="nf">_stop_actor</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Stop all running async tasks.&quot;&quot;&quot;</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_all_battery_status</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
        <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_stop</span><span class="p">()</span>  <span class="c1"># type: ignore # pylint: disable=no-member</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">







<h5 id="frequenz.sdk.actor.power_distributing.PowerDistributingActor-functions">Functions<a href="#frequenz.sdk.actor.power_distributing.PowerDistributingActor-functions" class="headerlink" title="Permanent link">¤</a></h5>

<div class="doc doc-object doc-function">



<h6 id="frequenz.sdk.actor.power_distributing.power_distributing.PowerDistributingActor.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="n">requests_receiver</span><span class="p">,</span> <span class="n">channel_registry</span><span class="p">,</span> <span class="n">battery_status_sender</span><span class="p">,</span> <span class="n">wait_for_data_sec</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#frequenz.sdk.actor.power_distributing.power_distributing.PowerDistributingActor.__init__" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>Create class instance.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>requests_receiver</code></td>
          <td class="doc-param-details">
            <div class="doc-md-description">
              <p>Receiver for receiving power requests from other actors.</p>
            </div>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="frequenz.channels.Receiver">Receiver</span>[<a class="autorefs autorefs-internal" title="frequenz.sdk.actor.power_distributing.request.Request" href="request/#frequenz.sdk.actor.power_distributing.request.Request">Request</a>]</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>channel_registry</code></td>
          <td class="doc-param-details">
            <div class="doc-md-description">
              <p>Channel registry for creating result channels dynamically
for each request namespace.</p>
            </div>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><a class="autorefs autorefs-internal" title="frequenz.sdk.actor.ChannelRegistry" href="../#frequenz.sdk.actor.ChannelRegistry">ChannelRegistry</a></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>battery_status_sender</code></td>
          <td class="doc-param-details">
            <div class="doc-md-description">
              <p>Channel for sending information which batteries are
working.</p>
            </div>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="frequenz.channels.Sender">Sender</span>[<a class="autorefs autorefs-internal" title="frequenz.sdk.actor.power_distributing._battery_pool_status.BatteryStatus" href="#frequenz.sdk.actor.power_distributing.BatteryStatus">BatteryStatus</a>]</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>wait_for_data_sec</code></td>
          <td class="doc-param-details">
            <div class="doc-md-description">
              <p>How long actor should wait before processing first
request. It is a time needed to collect first components data.</p>
            </div>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><a class="autorefs autorefs-external" href="https://docs.python.org/3/library/functions.html#float">float</a></code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>2</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/power_distributing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">requests_receiver</span><span class="p">:</span> <span class="n">Receiver</span><span class="p">[</span><span class="n">Request</span><span class="p">],</span>
    <span class="n">channel_registry</span><span class="p">:</span> <span class="n">ChannelRegistry</span><span class="p">,</span>
    <span class="n">battery_status_sender</span><span class="p">:</span> <span class="n">Sender</span><span class="p">[</span><span class="n">BatteryStatus</span><span class="p">],</span>
    <span class="n">wait_for_data_sec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">2</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create class instance.</span>

<span class="sd">    Args:</span>
<span class="sd">        requests_receiver: Receiver for receiving power requests from other actors.</span>
<span class="sd">        channel_registry: Channel registry for creating result channels dynamically</span>
<span class="sd">            for each request namespace.</span>
<span class="sd">        battery_status_sender: Channel for sending information which batteries are</span>
<span class="sd">            working.</span>
<span class="sd">        wait_for_data_sec: How long actor should wait before processing first</span>
<span class="sd">            request. It is a time needed to collect first components data.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_requests_receiver</span> <span class="o">=</span> <span class="n">requests_receiver</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_channel_registry</span> <span class="o">=</span> <span class="n">channel_registry</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_data_sec</span> <span class="o">=</span> <span class="n">wait_for_data_sec</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_result_senders</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Sender</span><span class="p">[</span><span class="n">Result</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dictionary of result senders for each request namespace.</span>

<span class="sd">    They are for channels owned by the channel registry, we just hold a reference</span>
<span class="sd">    to their senders, for fast access.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># NOTE: power_distributor_exponent should be received from ConfigManager</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">power_distributor_exponent</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">distribution_algorithm</span> <span class="o">=</span> <span class="n">DistributionAlgorithm</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">power_distributor_exponent</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_inv_bat_map</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_components_pairs</span><span class="p">(</span>
        <span class="n">connection_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">component_graph</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_battery_receivers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Peekable</span><span class="p">[</span><span class="n">BatteryData</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_inverter_receivers</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">Peekable</span><span class="p">[</span><span class="n">InverterData</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_all_battery_status</span> <span class="o">=</span> <span class="n">BatteryPoolStatus</span><span class="p">(</span>
        <span class="n">battery_ids</span><span class="o">=</span><span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
        <span class="n">battery_status_sender</span><span class="o">=</span><span class="n">battery_status_sender</span><span class="p">,</span>
        <span class="n">max_blocking_duration_sec</span><span class="o">=</span><span class="mf">30.0</span><span class="p">,</span>
        <span class="n">max_data_age_sec</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">_cached_metrics</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">_CacheEntry</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">bat_id</span><span class="p">:</span> <span class="kc">None</span> <span class="k">for</span> <span class="n">bat_id</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bat_inv_map</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="frequenz.sdk.actor.power_distributing.power_distributing.PowerDistributingActor.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.power_distributing.PowerDistributingActor.run" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>Run actor main function.</p>
<p>It waits for new requests in task_queue and process it, and send
<code>set_power</code> request with distributed power.
The output of the <code>set_power</code> method is processed.
Every battery and inverter that failed or didn't respond in time will be marked
as broken for some time.</p>

      <details class="quote">
        <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/power_distributing.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run actor main function.</span>

<span class="sd">    It waits for new requests in task_queue and process it, and send</span>
<span class="sd">    `set_power` request with distributed power.</span>
<span class="sd">    The output of the `set_power` method is processed.</span>
<span class="sd">    Every battery and inverter that failed or didn&#39;t respond in time will be marked</span>
<span class="sd">    as broken for some time.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_create_channels</span><span class="p">()</span>

    <span class="n">api</span> <span class="o">=</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">get</span><span class="p">()</span><span class="o">.</span><span class="n">api_client</span>

    <span class="c1"># Wait few seconds to get data from the channels created above.</span>
    <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_wait_for_data_sec</span><span class="p">)</span>

    <span class="k">async</span> <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_requests_receiver</span><span class="p">:</span>
        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_request</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">error</span><span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">pairs_data</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">InvBatPair</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_components_data</span><span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">batteries</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">include_broken_batteries</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">pairs_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">include_broken_batteries</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;No data for the given batteries </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">batteries</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">distribution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_power_distribution</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">pairs_data</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">error_msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Couldn&#39;t distribute power, error: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span>
                <span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">Error</span><span class="p">(</span><span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">error_msg</span><span class="p">))</span>
            <span class="p">)</span>
            <span class="k">continue</span>

        <span class="n">distributed_power_value</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">power</span> <span class="o">-</span> <span class="n">distribution</span><span class="o">.</span><span class="n">remaining_power</span>
        <span class="n">battery_distribution</span> <span class="o">=</span> <span class="p">{</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_inv_bat_map</span><span class="p">[</span><span class="n">bat_id</span><span class="p">]:</span> <span class="n">dist</span>
            <span class="k">for</span> <span class="n">bat_id</span><span class="p">,</span> <span class="n">dist</span> <span class="ow">in</span> <span class="n">distribution</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">_logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
            <span class="s2">&quot;Distributing power </span><span class="si">%d</span><span class="s2"> between the batteries </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">distributed_power_value</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">battery_distribution</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="n">failed_power</span><span class="p">,</span> <span class="n">failed_batteries</span> <span class="o">=</span> <span class="k">await</span> <span class="bp">self</span><span class="o">.</span><span class="n">_set_distributed_power</span><span class="p">(</span>
            <span class="n">api</span><span class="p">,</span> <span class="n">distribution</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">request_timeout_sec</span>
        <span class="p">)</span>

        <span class="n">response</span><span class="p">:</span> <span class="n">Success</span> <span class="o">|</span> <span class="n">PartialFailure</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">failed_batteries</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">succeed_batteries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">battery_distribution</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="o">-</span> <span class="n">failed_batteries</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">PartialFailure</span><span class="p">(</span>
                <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                <span class="n">succeeded_power</span><span class="o">=</span><span class="n">distributed_power_value</span><span class="p">,</span>
                <span class="n">succeeded_batteries</span><span class="o">=</span><span class="n">succeed_batteries</span><span class="p">,</span>
                <span class="n">failed_power</span><span class="o">=</span><span class="n">failed_power</span><span class="p">,</span>
                <span class="n">failed_batteries</span><span class="o">=</span><span class="n">failed_batteries</span><span class="p">,</span>
                <span class="n">excess_power</span><span class="o">=</span><span class="n">distribution</span><span class="o">.</span><span class="n">remaining_power</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">succeed_batteries</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">battery_distribution</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">Success</span><span class="p">(</span>
                <span class="n">request</span><span class="o">=</span><span class="n">request</span><span class="p">,</span>
                <span class="n">succeeded_power</span><span class="o">=</span><span class="n">distributed_power_value</span><span class="p">,</span>
                <span class="n">succeeded_batteries</span><span class="o">=</span><span class="n">succeed_batteries</span><span class="p">,</span>
                <span class="n">excess_power</span><span class="o">=</span><span class="n">distribution</span><span class="o">.</span><span class="n">remaining_power</span><span class="p">,</span>
            <span class="p">)</span>

        <span class="n">asyncio</span><span class="o">.</span><span class="n">gather</span><span class="p">(</span>
            <span class="o">*</span><span class="p">[</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_all_battery_status</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span>
                    <span class="n">succeed_batteries</span><span class="p">,</span> <span class="n">failed_batteries</span>
                <span class="p">),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_result</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">namespace</span><span class="p">,</span> <span class="n">response</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="frequenz.sdk.actor.power_distributing.Request" class="doc doc-heading">
        <code>frequenz.sdk.actor.power_distributing.Request</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.Request" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">

  
      <p>Request to set power to the <code>PowerDistributingActor</code>.</p>


        <details class="quote">
          <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/request.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Request</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Request to set power to the `PowerDistributingActor`.&quot;&quot;&quot;</span>

    <span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The namespace of the request.</span>

<span class="sd">    This will be used to identify the channel for sending the response into, in the</span>
<span class="sd">    channel registry.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">power</span><span class="p">:</span> <span class="nb">float</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The requested power in watts.&quot;&quot;&quot;</span>

    <span class="n">batteries</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The component ids of the batteries to be used for this request.&quot;&quot;&quot;</span>

    <span class="n">request_timeout_sec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The maximum amount of time to wait for the request to be fulfilled.&quot;&quot;&quot;</span>

    <span class="n">adjust_power</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to adjust the power to match the bounds.</span>

<span class="sd">    If `True`, the power will be adjusted (lowered) to match the bounds, so</span>
<span class="sd">    only the reduced power will be set.</span>

<span class="sd">    If `False` and the power is outside the batteries&#39; bounds, the request will</span>
<span class="sd">    fail and be replied to with an `OutOfBound` result.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">include_broken_batteries</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Whether to use all batteries included in the batteries set regardless the status.</span>

<span class="sd">    If set to `True`, the power distribution algorithm will consider all batteries,</span>
<span class="sd">    including the broken ones, when distributing power.  In such cases, any remaining</span>
<span class="sd">    power after distributing among the available batteries will be distributed equally</span>
<span class="sd">    among the unavailable (broken) batteries.  If all batteries in the set are</span>
<span class="sd">    unavailable, the power will be equally distributed among all the unavailable</span>
<span class="sd">    batteries in the request.</span>

<span class="sd">    If set to `False`, the power distribution will only take into account the available</span>
<span class="sd">    batteries, excluding any broken ones.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  

  <div class="doc doc-children">





<h5 id="frequenz.sdk.actor.power_distributing.Request-attributes">Attributes<a href="#frequenz.sdk.actor.power_distributing.Request-attributes" class="headerlink" title="Permanent link">¤</a></h5>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.request.Request.adjust_power" class="doc doc-heading">
<code class="highlight language-python"><span class="n">adjust_power</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.request.Request.adjust_power" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>Whether to adjust the power to match the bounds.</p>
<p>If <code>True</code>, the power will be adjusted (lowered) to match the bounds, so
only the reduced power will be set.</p>
<p>If <code>False</code> and the power is outside the batteries' bounds, the request will
fail and be replied to with an <code>OutOfBound</code> result.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.request.Request.batteries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">batteries</span><span class="p">:</span> <span class="n">abc</span><span class="o">.</span><span class="n">Set</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.request.Request.batteries" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>The component ids of the batteries to be used for this request.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.request.Request.include_broken_batteries" class="doc doc-heading">
<code class="highlight language-python"><span class="n">include_broken_batteries</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.request.Request.include_broken_batteries" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>Whether to use all batteries included in the batteries set regardless the status.</p>
<p>If set to <code>True</code>, the power distribution algorithm will consider all batteries,
including the broken ones, when distributing power.  In such cases, any remaining
power after distributing among the available batteries will be distributed equally
among the unavailable (broken) batteries.  If all batteries in the set are
unavailable, the power will be equally distributed among all the unavailable
batteries in the request.</p>
<p>If set to <code>False</code>, the power distribution will only take into account the available
batteries, excluding any broken ones.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.request.Request.namespace" class="doc doc-heading">
<code class="highlight language-python"><span class="n">namespace</span><span class="p">:</span> <span class="nb">str</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.request.Request.namespace" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>The namespace of the request.</p>
<p>This will be used to identify the channel for sending the response into, in the
channel registry.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.request.Request.power" class="doc doc-heading">
<code class="highlight language-python"><span class="n">power</span><span class="p">:</span> <span class="nb">float</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.request.Request.power" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>The requested power in watts.</p>
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="frequenz.sdk.actor.power_distributing.request.Request.request_timeout_sec" class="doc doc-heading">
<code class="highlight language-python"><span class="n">request_timeout_sec</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">5.0</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.request.Request.request_timeout_sec" class="headerlink" title="Permanent link">¤</a></h6>


  <div class="doc doc-contents ">
  
      <p>The maximum amount of time to wait for the request to be fulfilled.</p>
  </div>

</div>





  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="frequenz.sdk.actor.power_distributing.Result" class="doc doc-heading">
        <code>frequenz.sdk.actor.power_distributing.Result</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.Result" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="frequenz.sdk.actor.power_distributing.result._BaseResultMixin">_BaseResultMixin</span></code></p>

  
      <p>Power distribution result.</p>


        <details class="quote">
          <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/result.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Result</span><span class="p">(</span><span class="n">_BaseResultMixin</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Power distribution result.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="frequenz.sdk.actor.power_distributing.Success" class="doc doc-heading">
        <code>frequenz.sdk.actor.power_distributing.Success</code>

  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-dataclass"><code>dataclass</code></small>
  </span>

<a href="#frequenz.sdk.actor.power_distributing.Success" class="headerlink" title="Permanent link">¤</a></h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="frequenz.sdk.actor.power_distributing.result._BaseSuccessMixin">_BaseSuccessMixin</span></code>, <code><a class="autorefs autorefs-internal" title="frequenz.sdk.actor.power_distributing.result.Result" href="result/#frequenz.sdk.actor.power_distributing.result.Result">Result</a></code></p>

  
      <p>Result returned when setting the power succeeded for all batteries.</p>


        <details class="quote">
          <summary>Source code in <code>/opt/hostedtoolcache/Python/3.11.3/x64/lib/python3.11/site-packages/frequenz/sdk/actor/power_distributing/result.py</code></summary>
          <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@dataclasses</span><span class="o">.</span><span class="n">dataclass</span>
<span class="k">class</span> <span class="nc">Success</span><span class="p">(</span><span class="n">_BaseSuccessMixin</span><span class="p">,</span> <span class="n">Result</span><span class="p">):</span>  <span class="c1"># Order matters here. See above.</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Result returned when setting the power succeeded for all batteries.&quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
        </details>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Frequenz Energy-as-a-Service GmbH
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/frequenz-floss" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/frequenz-com" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../../..", "features": ["navigation.instant", "navigation.tabs", "navigation.top", "navigation.tracking", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"default": "latest", "provider": "mike"}}</script>
    
    
      <script src="../../../../../assets/javascripts/bundle.b4d07000.min.js"></script>
      
    
  </body>
</html>